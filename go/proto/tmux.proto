syntax = "proto3";

package mcp.tmux.v1;

option go_package = "github.com/k8ika0s/mcp-tmux/go/proto;tmuxproto";

message PaneRef {
  string host = 1;   // ssh alias or empty for local
  string session = 2;
  string window = 3;
  string pane = 4;   // tmux pane id (optional if default)
}

message StreamPaneRequest {
  PaneRef target = 1;
  uint64 from_seq = 2;
  bool strip_ansi = 3;
  uint32 max_chunk_bytes = 4;
}

message PaneChunk {
  PaneRef target = 1;
  uint64 seq = 2;
  int64 ts_unix_millis = 3;
  bytes data = 4;
  bool is_truncated = 5;
  bool heartbeat = 6;
  bool eof = 7;
  string reason = 8;
}

message SnapshotRequest {
  PaneRef target = 1;
  uint32 capture_lines = 2;
}

message SnapshotResponse {
  string sessions = 1;
  string windows = 2;
  string panes = 3;
  string capture = 4;
}

message ListRequest { PaneRef target = 1; }
message ListResponse { string text = 1; }

message SetDefaultRequest { PaneRef target = 1; }
message SetDefaultResponse { string text = 1; }

message CapturePaneRequest {
  PaneRef target = 1;
  int32 lines = 2;        // negative or zero -> default tail
  bool strip_ansi = 3;
}

message CapturePaneResponse {
  string text = 1;
  bool truncated = 2;
}

message RunCommandRequest {
  PaneRef target = 1;
  repeated string args = 2;
  bool strip_ansi = 3;
}

message RunCommandResponse { string text = 1; }

message SendKeysRequest {
  PaneRef target = 1;
  repeated string keys = 2;
  bool enter = 3;
}

message SendKeysResponse { string text = 1; }

message RunBatchRequest {
  PaneRef target = 1;
  repeated string steps = 2;   // shell fragments to join
  string join_with = 3;        // default "&&"
  bool clean_prompt = 4;       // send C-c/C-u before running
  bool strip_ansi = 5;
  int32 capture_lines = 6;     // optional capture after run (0 = skip)
}

message RunBatchResponse {
  string text = 1;             // status message
  string capture = 2;          // optional capture text
  bool truncated = 3;
}

service TmuxService {
  rpc StreamPane(StreamPaneRequest) returns (stream PaneChunk);
  rpc Snapshot(SnapshotRequest) returns (SnapshotResponse);
  rpc CapturePane(CapturePaneRequest) returns (CapturePaneResponse);
  rpc RunCommand(RunCommandRequest) returns (RunCommandResponse);
  rpc SendKeys(SendKeysRequest) returns (SendKeysResponse);
  rpc RunBatch(RunBatchRequest) returns (RunBatchResponse);
  rpc ListSessions(ListRequest) returns (ListResponse);
  rpc ListWindows(ListRequest) returns (ListResponse);
  rpc ListPanes(ListRequest) returns (ListResponse);
  rpc SetDefault(SetDefaultRequest) returns (SetDefaultResponse);
}
